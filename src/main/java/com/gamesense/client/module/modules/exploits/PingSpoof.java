package com.gamesense.client.module.modules.exploits;

import com.gamesense.api.event.events.PacketEvent;
import com.gamesense.api.event.events.RenderEvent;
import com.gamesense.api.setting.values.IntegerSetting;
import com.gamesense.api.util.misc.Timer;
import com.gamesense.client.module.Category;
import com.gamesense.client.module.Module;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketKeepAlive;

import javax.crypto.NullCipher;
import java.util.Queue;

@Module.Declaration(name = "PingSpoof", category = Category.Exploits)
public class PingSpoof extends Module {

    IntegerSetting delay = registerInteger("Tick Delay", 10,0,100);

    Queue<Packet<?>> packets;

    @EventHandler
    private final Listener<PacketEvent.Send> keepAliveListener = new Listener<>(event -> {

        if (event.getPacket() instanceof CPacketKeepAlive) {

            this.packets.add(event.getPacket());
            event.cancel();

        }

    });

    @Override
    public void onUpdate() {

        if(mc.player.ticksExisted % delay.getValue() == 0) {

            try{
                mc.player.connection.sendPacket(packets.element());
                packets.remove();
            } catch (NullPointerException ignored){}

        }

    }

    @Override
    protected void onDisable() {
        for (int i = packets.size(); i > 0; i--) {

            mc.player.connection.sendPacket(packets.element());
            packets.remove();

        }
    }
}
